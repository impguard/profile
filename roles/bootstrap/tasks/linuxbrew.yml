- name: Download linuxbrew dependencies
  apt:
    name:
    - build-essential
    - curl
    - file
    - git
    - gcc

- name: Download linuxbrew installer
  get_url:
    url: https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh
    dest: /tmp/linuxbrew.sh
    mode: 0755

- name: Run linuxbrew installer
  become: no
  shell: /tmp/linuxbrew.sh

- name: Cleanup linuxbrew installer
  file:
    name: /tmp/linuxbrew.sh
    state: absent

- name: Gather linuxbrew path
  become: no
  shell: |
    test -d ~/.linuxbrew && PATH="$HOME/.linuxbrew/bin:$HOME/.linuxbrew/sbin:$PATH"
    test -d /home/linuxbrew/.linuxbrew && PATH="/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin:$PATH"
    brew --prefix
  register: brewpath

- name: Update path for linuxbrew
  become: no
  environment:
    PATH: /home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin:{{ ansible_env.PATH }}
  blockinfile:
    dest: "~/.bashrc.d/linuxbrew.bashrc"
    block: |
      export PATH={{ brewpath.stdout }}/bin:{{ brewpath.stdout }}/sbin:{{ ansible_env.PATH }}
    marker: "# {mark} ANSIBLE - linuxbrew"
    insertbefore: BOF
    create: yes
